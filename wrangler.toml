name = "bus-auth"
main = "src/index.ts"
compatibility_date = "2025-12-01"
workers_dev = true

[vars]
ADMIN_IP_ALLOWLIST = "142.90.207.149"
ELIGIBLE_PRICE_IDS = "price_1SifxXBAvVMaiDTdz1QF6BM1"
CHECKOUT_SUCCESS_URL = "https://buscore.ca/success"
CHECKOUT_CANCEL_URL = "https://buscore.ca/cancel"
EMAIL_FROM = "BUS Core Auth <auth@buscore.ca>"
# ADDED: Default price ID so empty {} bodies work
STRIPE_PRICE_DEFAULT = "price_1SifxXBAvVMaiDTdz1QF6BM1"

IDENTITY_PUBLIC_KEY = """
-----BEGIN PUBLIC KEY-----
MCowBQYDK2VwAyEA1vhCDACNL3gDVRYyeFTjEMdHMVfF12+yvnzVLld0q3s=
-----END PUBLIC KEY-----
"""

ENTITLEMENT_PUBLIC_KEY = ""

# Keep logs enabled so you can debug in Cloudflare dashboard
[observability.logs]
enabled = true

[[d1_databases]]
binding = "DB"
database_name = "bus-auth-db"
database_id = "c4120c73-2d08-4e87-8e4c-e402cfbb4f05"

routes = [
  { pattern = "auth.buscore.ca/*", zone_name = "buscore.ca" }
]

[[kv_namespaces]]
binding = "RATE_LIMITS"
id = "eaeb742be3214279a15bb5d352ecb56c"
